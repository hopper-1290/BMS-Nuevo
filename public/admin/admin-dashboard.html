<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BARANGAY MANAGEMENT SYSTEM ‚Äî ADMIN</title>
  <link rel="stylesheet" href="./admin-dashboard.css">
</head>
<body class="admin-theme">
  <header class="adm-header">
    <div class="left">
      <img src="/public/admin/logo.png" alt="Barangay Logo" class="logo" onerror="this.style.display='none'"/>
      <div class="title">BARANGAY MANAGEMENT SYSTEM ‚Äî ADMIN</div>
    </div>
    <div class="center">Admin Dashboard ‚Äî <span id="adminName">[AdminName]</span>
      <div style="font-size: 11px; color: #666; margin-top: 4px;">
        <span data-clock>00:00:00 AM</span> | <span data-date>Loading...</span>
      </div>
    </div>
    <div class="right">
      <button class="icon-btn" id="btnNotifications" aria-label="Notifications">üîî<span class="badge" id="notifCount">0</span></button>
      <button class="icon-btn" id="btnMessages" aria-label="Messages">‚úâÔ∏è<span class="badge" id="msgCount">0</span></button>
    </div>
  </header>

  <div class="layout">
    <nav class="sidebar" role="navigation" id="sidebarNav">
      <!-- Sidebar content loaded dynamically from sidebars/admin-sidebar.html -->
    </nav>

    <main class="content">
      <!-- Overview -->
      <section id="overview" class="panel">
        <div class="summary-grid">
          <div class="card summary-card" id="cardRecentActivity">
            <h3>Recent Activity / Notifications</h3>
            <div class="feed" id="recentFeed">
              <!-- feed items appended here -->
            </div>
            <a href="#" class="view-all" data-link="auditlogs">View full audit log</a>
          </div>

          <div class="card summary-card" id="cardPendingQueue">
            <h3>Pending Items Queue</h3>
            <div class="filters">
              <select id="pendingCategoryFilter">
                <option value="all">All</option>
                <option value="residents">Pending Resident Registrations</option>
                <option value="documents">Pending Documents</option>
                <option value="complaints">Pending Complaints</option>
              </select>
              <input type="search" id="pendingSearch" placeholder="Search pending items..." />
            </div>
            <div class="pending-list" id="pendingList">
              <!-- rows will be rendered here -->
            </div>
            <div class="small-note">Quick actions available: Approve / Reject / View details</div>
          </div>

          <div class="card summary-card" id="cardAudit">
            <h3>Audit Logs Snapshot</h3>
            <table class="mini-table" id="auditSnapshot">
              <thead><tr><th>Actor</th><th>Action</th><th>Target</th><th>Time</th></tr></thead>
              <tbody></tbody>
            </table>
            <a class="view-all" data-link="auditlogs">Open Audit Viewer</a>
          </div>

          <div class="card summary-card" id="cardSessions">
            <h3>User Sessions & Security</h3>
            <div id="sessionsPanel">
              <!-- active sessions list -->
            </div>
            <div class="session-actions">
              <button id="btnSignOutAll" class="btn warn">Sign out selected</button>
            </div>
          </div>

          <div class="card summary-card" id="cardExports">
            <h3>Reports & Exports</h3>
            <div class="exports-actions">
              <button id="btnNewExport" class="btn primary">Generate Report</button>
              <div class="recent-exports" id="recentExports">
                <!-- recent exports list -->
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Pending Queue Section -->
      <section id="pending" class="panel" hidden>
        <h2>Pending Items</h2>
        <div class="table-wrap" id="pendingTableWrap">
          <table class="data-table" id="pendingTable">
            <thead>
              <tr><th>Type</th><th>Reference</th><th>SubmittedBy</th><th>Date</th><th>Status</th><th>Actions</th></tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="pagination" id="pendingPager"></div>
        </div>
      </section>

      <!-- Audit Snapshot -->
      <section id="audit" class="panel" hidden>
        <h2>Audit Snapshot</h2>
        <div class="table-wrap">
          <table class="data-table" id="auditTable">
            <thead>
              <tr><th>Timestamp</th><th>Actor</th><th>ActionType</th><th>Target</th><th>Details</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Sessions -->
      <section id="sessions" class="panel" hidden>
        <h2>Active Admin Sessions</h2>
        <div class="table-wrap">
          <table class="data-table" id="sessionsTable">
            <thead><tr><th>SessionID</th><th>Admin</th><th>IP</th><th>Device</th><th>Started</th><th>Actions</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Management Panels (skeletons) -->
      <section id="residents" class="panel" hidden>
        <h2>Manage Residents</h2>
        <div class="controls">
          <input id="resSearch" placeholder="Search residents" />
          <select id="resFilterPurok"><option value="">All Purok</option></select>
        </div>
        <div class="table-wrap">
          <table class="data-table" id="residentsTable">
            <thead>
              <tr>
                <th>ResidentID</th><th>Name</th><th>Age</th><th>Sex</th><th>Purok</th><th>Contact</th><th>Status</th><th>RegisteredAt</th><th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section id="events" class="panel" hidden>
        <h2>Manage Events</h2>
        <div id="eventsControls"></div>
        <div class="table-wrap">
          <table class="data-table" id="eventsTable"><thead><tr><th>EventID</th><th>Title</th><th>Organizer</th><th>Start</th><th>Venue</th><th>Status</th><th>Actions</th></tr></thead><tbody></tbody></table>
        </div>
      </section>

      <section id="announcements" class="panel" hidden>
        <h2>Manage Announcements</h2>
        <div class="table-wrap">
          <table class="data-table" id="annTable"><thead><tr><th>ID</th><th>Title</th><th>Audience</th><th>Start</th><th>End</th><th>Status</th><th>Actions</th></tr></thead><tbody></tbody></table>
        </div>
      </section>

      <section id="users" class="panel" hidden>
        <h2>Manage Users</h2>
        <div class="table-wrap">
          <table class="data-table" id="usersTable"><thead><tr><th>UserID</th><th>Username</th><th>FullName</th><th>Roles</th><th>Status</th><th>LastLogin</th><th>Actions</th></tr></thead><tbody></tbody></table>
        </div>
      </section>

      <section id="officials" class="panel" hidden>
        <h2>Manage Officials</h2>
        <div class="table-wrap">
          <table class="data-table" id="officialsTable"><thead><tr><th>OfficialID</th><th>FullName</th><th>Position</th><th>Term</th><th>Status</th><th>Actions</th></tr></thead><tbody></tbody></table>
        </div>
      </section>

      <section id="complaints" class="panel" hidden>
        <h2>Manage Complaints</h2>
        <div class="table-wrap">
          <table class="data-table" id="complaintsTable"><thead><tr><th>Ref</th><th>Complainant</th><th>Category</th><th>DateReported</th><th>Status</th><th>Priority</th><th>Actions</th></tr></thead><tbody></tbody></table>
        </div>
      </section>

      <section id="documents" class="panel" hidden>
        <h2>Manage Documents</h2>
        <div class="controls-top">
          <input id="docSearch" placeholder="Search by resident name or reference..." />
          <select id="docStatusFilter">
            <option value="">All Status</option>
            <option value="pending">Pending Review</option>
            <option value="approved">Approved</option>
            <option value="rejected">Rejected</option>
            <option value="ready">Ready for Pickup</option>
          </select>
          <select id="docTypeFilter">
            <option value="">All Document Types</option>
            <option value="barangay_clearance">Barangay Clearance</option>
            <option value="residency">Residency Certificate</option>
            <option value="business_permit">Business Permit</option>
            <option value="indigent">Indigent Certificate</option>
            <option value="solo_parent">Solo Parent ID</option>
            <option value="certif_good_moral">Certificate of Good Moral</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="table-wrap">
          <table class="data-table" id="documentsTable">
            <thead>
              <tr>
                <th>Ref ID</th>
                <th>Resident Name</th>
                <th>Document Type</th>
                <th>Requested Date</th>
                <th>Status</th>
                <th>Requested By</th>
                <th>Approved By</th>
                <th>Notes</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="pagination" id="docPagination"></div>
        </div>
      </section>

      <section id="auditlogs" class="panel" hidden>
        <h2>Manage Audit Logs</h2>
        <div class="table-wrap">
          <div class="controls"><input id="auditSearch" placeholder="Search logs"/></div>
          <table class="data-table" id="auditLogsTable"><thead><tr><th>LogID</th><th>Time</th><th>Actor</th><th>Action</th><th>Target</th><th>IP</th><th>Details</th></tr></thead><tbody></tbody></table>
        </div>
      </section>

      <section id="imports" class="panel" hidden>
        <h2>Import Data</h2>
        <div class="card">
          <form id="importForm">
            <label>Dataset
              <select id="importDataset"><option value="residents">Residents</option><option value="events">Events</option><option value="officials">Officials</option></select>
            </label>
            <label>File<input type="file" id="importFile" accept=".csv,.xlsx,.json" /></label>
            <button class="btn" id="btnUpload">Upload & Validate</button>
          </form>
          <div id="importPreview"></div>
        </div>
      </section>

      <section id="exportdata" class="panel" hidden>
        <h2>Export Data</h2>
        <div class="card">
          <div class="export-controls">
            <h3>Export Options</h3>
            <form id="exportForm">
              <div class="form-row">
                <label>
                  Select Dataset to Export:
                  <select id="exportDataset" required>
                    <option value="">-- Choose Dataset --</option>
                    <option value="residents">Residents</option>
                    <option value="events">Events</option>
                    <option value="announcements">Announcements</option>
                    <option value="officials">Officials</option>
                    <option value="complaints">Complaints</option>
                    <option value="documents">Documents</option>
                    <option value="audit_logs">Audit Logs</option>
                    <option value="users">Users</option>
                    <option value="all">All Data (Complete Backup)</option>
                  </select>
                </label>
              </div>

              <div class="form-row">
                <label>
                  Export Format:
                  <select id="exportFormat" required>
                    <option value="csv">CSV (Comma-Separated Values)</option>
                    <option value="xlsx">Excel (.xlsx)</option>
                    <option value="json">JSON (JavaScript Object Notation)</option>
                    <option value="pdf">PDF Report</option>
                  </select>
                </label>
              </div>

              <div class="form-row">
                <label>
                  Date Range (Optional):
                  <input type="date" id="exportStartDate" />
                  to
                  <input type="date" id="exportEndDate" />
                </label>
              </div>

              <div class="form-row">
                <label>
                  <input type="checkbox" id="exportIncludeArchived" />
                  Include Archived Records
                </label>
              </div>

              <div class="form-row">
                <label>
                  <input type="checkbox" id="exportEncrypt" />
                  Encrypt File (Recommended for Sensitive Data)
                </label>
              </div>

              <div class="form-actions">
                <button type="submit" class="btn primary" id="btnExport">
                  üì• Generate & Download Export
                </button>
                <button type="reset" class="btn secondary">Reset Form</button>
              </div>
            </form>
          </div>

          <hr class="divider" />

          <div class="export-history">
            <h3>Recent Exports</h3>
            <div class="controls">
              <input type="search" id="exportSearch" placeholder="Search exports by dataset or date..." />
              <select id="exportStatusFilter">
                <option value="">All Status</option>
                <option value="completed">Completed</option>
                <option value="pending">Pending</option>
                <option value="failed">Failed</option>
              </select>
            </div>
            <div class="table-wrap">
              <table class="data-table" id="exportHistoryTable">
                <thead>
                  <tr>
                    <th>Export ID</th>
                    <th>Dataset</th>
                    <th>Format</th>
                    <th>Records</th>
                    <th>Size</th>
                    <th>Created By</th>
                    <th>Date & Time</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="exportHistoryBody">
                  <tr>
                    <td colspan="9" class="text-center text-muted">No exports yet. Generate your first export above.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="export-info" style="margin-top: 20px; padding: 15px; background-color: #f0f4f8; border-left: 4px solid #2196F3; border-radius: 4px;">
            <h4>‚ÑπÔ∏è Export Information</h4>
            <ul>
              <li><strong>CSV Format:</strong> Best for spreadsheet applications (Excel, Google Sheets)</li>
              <li><strong>Excel Format:</strong> Formatted spreadsheets with multiple sheets</li>
              <li><strong>JSON Format:</strong> Best for data import to other systems or databases</li>
              <li><strong>PDF Format:</strong> Professional reports suitable for printing and archiving</li>
              <li><strong>Encryption:</strong> Protects sensitive data during transmission and storage</li>
              <li><strong>Date Range:</strong> Leave empty to export all records</li>
              <li><strong>Archived Records:</strong> Include deleted/inactive records if checked</li>
            </ul>
          </div>
        </div>
      </section>

    </main>
  </div>

  <script src="../js/realtime.js"></script>
  <script src="../js/auth-redirect.js"></script>
  <script src="../js/sidebar-loader.js"></script>
  <script src="./admin-dashboard.js"></script>
  <script>
    // Load admin dashboard sidebar sections
    document.addEventListener('DOMContentLoaded', async () => {
      const adminSections = ['clock', 'overview', 'users', 'system', 'logs'];
      await loadSidebarSections('admin', adminSections);
      setupNavigation();
    });
  </script>
</body>
</html>